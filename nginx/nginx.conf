server {
    listen 80;
    server_name offnd.at;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.offnd.at http://api.offnd.at http://api:8080;" always;

    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # Regex for generated phrases (UTF-8 support)
    location ~ "(*UTF8)^\/(((\p{Lu}|\p{Lt})\p{Ll}*){3,}|([\p{Ll}']+-){2,}([\p{Ll}']+))$"  {
        resolver 127.0.0.11 ipv6=off;
        proxy_pass http://api:8080/v1/redirects$request_uri;
    }
}